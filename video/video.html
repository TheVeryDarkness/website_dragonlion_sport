<!DOCTYPE html>
<html>
<meta lang="zh-Hans-CN" charset="utf-8">

<body>
	<main>
		<h3>
			运动项目<select required id="s1" onchange="updateSelectBox()" size=1></select>
			年份<select required id="s2" onchange="updateSelectBox()" size=1></select>
			赛事<select required id="s3" onchange="updateSelectBox()" size=1></select>
			组别<select required id="s4" onchange="updateSelectBox()" size=1></select>
			队伍<select required id="s5" onchange="updateSelectBox()" size=1></select>
			动作<select required id="s6" onchange="updateSelectBox()" size=1></select>
			<input type="button" onclick="updateSelectBox()" value="刷新">
		</h3>
		<h4>
			<a>（温馨提示：请注意流量）视频时间范围：</a>
			(
			<a id="displayVideoTimeRange"></a>
			)
			<a id="originWebpage">源网页</a>
			<a id="originVideoURL">源视频</a>
		</h4>
		<video id="video" controls type="video/mp4">浏览器不支持HTML5视频，请使用高版本浏览器或点击链接
			<source id="localVideoCache">
			<source id="sourceVideo">
		</video>
		<!--
			Pay attention to the data format:
				group name, local cache path, source video path, source webpage path
		-->
		<p hidden id="videoSrcData">
			舞龙;
				2019;
					全国舞龙舞狮锦标赛;
						规定（男子组）, 2019/全国舞龙舞狮锦标赛/规定/20191110wlgd.mp4, http://videoflv.sports.cn/201911/20191110wlgd.mp4, http://dragonlion.sport.org.cn/home/zhxw/2019-11-21/542357.html;
							南京理工大学, 45, 570;
								开场造型, 68, 124;
								;
								绕场跳龙五次, 126, 152;
								;
								正反腾跃前进, 156, 176;
								;
								快速游龙, 180, 190;
								;
								连续快腾进三次, 190, 210;
								;
								造型（尾盘，龙头戏珠）, 210, 230;
								;
								大横八字花（成型四次）, 230, 260;
								;
								左右螺旋跳龙接摇船, 260, 281;
								;
								大立圆螺旋行进, 282, 305;
								;
								起伏圆盘, 305, 321;
								;
								双杆, 321, 357;
								;
								造型（菱形）, 356, 363;
								;
								换位跳龙, 363, 377;
								;
								绕身舞龙, 377, 386;
								;
								站腿, 386, 397;
								;
								起伏圆盘接穿龙尾, 397, 406;
								;
								卧龙腾飞, 405, 414;
								;
								躺肩挂腰（直躺挂腰）, 413, 427;
								;
								造型（立龙）（龙脱衣）, 427, 427;
								;
							;
							湖南师范大学, 592, 1533;
							;
							湖北队, 1597, 2133;
							;
							台州学院, 2195, 2723;
							;
							上海三林, 2791, 3300;
							;
							集美大学, 3348, 3888;
							;
						;
						传统（女子组）, 2019/全国舞龙舞狮锦标赛/传统/20191109ctwl.mp4, http://videoflv.sports.cn/201911/20191109ctwl.mp4, http://dragonlion.sport.org.cn/home/zhxw/2019-11-21/542338.html;
							常州大学, 24, 542;
							;
							扬州工职院, 644, 1151;
							;
							江阴职院, 1335, 1841;
							;
							湖北队, 1929, 2463;
							;
						;
						传统（男子组）, 2019/全国舞龙舞狮锦标赛/传统/20191109ctwl.mp4, http://videoflv.sports.cn/201911/20191109ctwl.mp4, http://dragonlion.sport.org.cn/home/zhxw/2019-11-21/542338.html;
							南理工紫金学院, 2499, 2870;
							;
							扬州工职院, 3026, 3512;
							;
							常州大学, 6026, 6555;
							;
						;
					;
				;
			;
		</p>
		<script type="text/javascript">
			//<!--
			function setVideoSourcePath(querySelector, srcPath) {
				querySelector.src = srcPath;
			}
			function findAQuerySelector(id) {
				return document.querySelector("#" + id);
			}
			function setVideoSourcePathWithId(video_id, srcPath) {
				var qS = findAQuerySelector(video_id);
				if (qS)
					setVideoSourcePath(qS, srcPath);
				else console.log("Failed to find a query selector with matching id.");
			}
			function Node(value) {
				this.value = value.split(',');
				this.sub = new Array(0);
				this.toString = function () {
					var str = new String(this.value);
					for (const child of this.sub) {
						str += child.toString();
					}
					return str;
				}
			}
			//Use callback.back() to generate a tree
			function MultiTree(callback) {
				this.root = new Node(callback.call());
				this.toString = function () {
					return this.root.toString();
				}
				var nodesStack = new Array();//里面存的都是Node对象
				if (this.root.value === null) return;

				nodesStack.push(this.root);
				while (true) {
					var value = callback.call();
					if (value) {
						var tmp = new Node(value);
						nodesStack[nodesStack.length - 1].sub.push(tmp);
						nodesStack.push(tmp);
					}
					else {
						if (nodesStack.length > 0)
							nodesStack.pop();
						else break;
					}
				}
			}
			function StringSplit(string) {
				const node_separator = ';';
				this.split = string.split(node_separator);
				this.call = function (thisObject) {
					if (this.split.length > 0)
						return this.split.shift();
					else return null;
				}
			}
			function makeAMultiTree(str) {
				var split = new StringSplit(str);
				var rev = new MultiTree(split);
				if (split.length > 0)
					console.log("Debug failed. Unexpected tree termination.");
				return rev;
			}
			const selectBoxMaxSize = 6;
			function fillSelectBoxWithSubValues(selectBox, subArray) {
				selectBox.options.length = subArray.length;
				for (const i in subArray) {
					selectBox.options[i].text = subArray[i].value[0];
				}
			}
			function fillSelectBoxWithNodes(selectBox, nodes) {
				fillSelectBoxWithSubValues(selectBox, nodes);
			}
			function nextNodes(nodes, selectedIndex) {
				if (selectedIndex === -1) {
					var rev = new Array;
					for (const node of nodes) {
						rev = rev.concat(node.sub);
					}
					return rev;
				}
				else {
					return nodes[selectedIndex].sub;
				}
			}
			// Begin
			const tree = makeAMultiTree(videoSrcData.textContent.replace(/\n[\t]*/g, ''));
			s1.selectedIndex = 0;
			s2.selectedIndex = 0;
			s3.selectedIndex = 0;
			s4.selectedIndex = 0;
			s5.selectedIndex = 0;
			s6.selectedIndex = 0;
			updateSelectBox();
			// End

			function updateSelectBox() {
				const nodes1 = new Array(tree.root);//运动项目
				fillSelectBoxWithNodes(s1, nodes1);
				const nodes2 = nextNodes(nodes1, s1.selectedIndex);//年份
				fillSelectBoxWithNodes(s2, nodes2);
				const nodes3 = nextNodes(nodes2, s2.selectedIndex);//赛事
				fillSelectBoxWithNodes(s3, nodes3);
				const nodes4 = nextNodes(nodes3, s3.selectedIndex);//组别
				fillSelectBoxWithNodes(s4, nodes4);
				const nodes5 = nextNodes(nodes4, s4.selectedIndex);//队伍
				if (s4.selectedIndex !== -1) {
					localVideoCache.src = nodes4[s4.selectedIndex].value[1];
					originVideoURL.href = nodes4[s4.selectedIndex].value[2];
					sourceVideo.src = nodes4[s4.selectedIndex].value[2];
					originWebpage.href = nodes4[s4.selectedIndex].value[3];
					video.load();
				}
				fillSelectBoxWithNodes(s5, nodes5);
				const nodes6 = nextNodes(nodes5, s5.selectedIndex);//动作
				fillSelectBoxWithNodes(s6, nodes6);

				var range;
				if(s6.selectedIndex !== -1)
					range = nodes6[s6.selectedIndex].value;
				else if(s5.selectedIndex !== -1)
					range = nodes5[s5.selectedIndex].value;
					
				videoTimeBegin = range[1];
				videoTimeEnd = range[2];
				displayVideoTimeRange.innerText = secToTime(videoTimeBegin) + ', ' + secToTime(videoTimeEnd);
				updateVideo();
			}
			function updateVideo() {
				video.currentTime = videoTimeBegin;
				video.addEventListener('timeupdate', checkTimeRange);
				video.play();
			}
			function checkTimeRange() {
				if (video.currentTime >= videoTimeEnd) {
					video.pause();
					video.removeEventListener('timeupdate', checkTimeRange);
				}
			}
			function secToTime(seconds) {
				return Math.floor(seconds / 3600) + ':' + Math.floor(seconds % 3600 / 60) + ':' + seconds % 60;
			}
		//-->
		</script>
		<noscript>浏览器不支持脚本，请使用高版本浏览器或点击链接</noscript>
	</main>
</body>
</html>