<!DOCTYPE html>
<html>
<meta lang="zh-Hans-CN" charset="utf-8">

<body>
	<main>
		<h2>
			运动项目<select required id="s1" multiple=false></select>
			年份<select required id="s2" multiple=false></select>
			赛事<select required id="s3" multiple=false></select>
			组别<select required id="s4" multiple=false></select>
			队伍<select required id="s5" multiple=false></select>
			动作<select required id="s6" multiple=false></select>
			<small><a href="">官网</a></small>
		</h2>
		<video id="video" controls="controls" type="video/mp4" src="default">
			浏览器不支持HTML5视频，请使用高版本浏览器或点击链接
			<source src="movie.mp4" type="video/mp4">
			<source src="movie.mp4" type="video/mp4">
		</video>
		<script type="text/javascript">
			//<!--
			function setVideoSourcePath(querySelector, srcPath) {
				querySelector.src = srcPath;
			}
			function findAQuerySelector(id) {
				return document.querySelector("#" + id);
			}
			function setVideoSourcePathWithId(video_id, srcPath) {
				var qS = findAQuerySelector(video_id);
				if (qS)
					setVideoSourcePath(qS, srcPath);
				else console.log("Failed to find a query selector with matching id.");
			}
			function Node(callback) {
				this.value = callback.call();
				if (this.value === null) return;
				this.sub = new Array(0);
				this.toString = function () {
					var str = new String(this.value);
					for (const child of this.sub) {
						str += child.toString();
					}
					return str;
				}
				while (true) {
					this.sub.push(new Node(callback));
					if (this.sub[this.sub.length - 1].value === null) { }
					this.sub.pop();
					break;
				}
			}
			function MultiTree(callback) {
				this.root = new Node(callback);
				this.toString = function () {
					return this.root.toString();
				}
			}
			function StringSplit(string) {
				this.split = string.split(';');
				this.call = function (thisObject) {
					if (this.split.length > 0)
						return this.split.shift();
					else return null;
				}
			}
			function makeAMultiTree(string) {
				var split = new StringSplit(string);
				var rev = new MultiTree(split);
				if (split.length > 0)
					console.log("Debug failed. Unexpected tree termination.");
				return rev;
			}
			var selectBoxMaxSize = 6;

			function fillSelectBoxWithSubValues(selectBox, subArray) {
				selectBox.size += subArray.length;
				selectBox.size = Math.min(selectBox.size, selectBoxMaxSize);
				selectBox.options.length += subArray.length;
				for (const i in subArray) {
					selectBox.options[i].text = subArray[i].value;
				}
			}
			function fillSelectBoxWithNodes(selectBox, nodes) {
				for (const node of nodes) {
					fillSelectBoxWithSubValues(selectBox, node.sub);
				}
			}
			function setNext(nodes, selectBox) {
				if (selectBox.selectedIndex === -1) {
					var rev = new Array;
					for (const node of nodes) {
						rev.concat(node.sub);
					}
					return rev;
				}
				else {
					return new Array(node.sub[s1.options[s1.selectedIndex].index]);
				}
			}
			var tree = makeAMultiTree(
				"\
					舞龙;\
						2019;\
							全国舞龙舞狮锦标赛;\
								规定;\
									/2019/全国舞龙舞狮锦标赛/规定/20191110wlgd.mp4,\
									http://videoflv.sports.cn/201911/20191110wlgd.mp4,\
									http://dragonlion.sport.org.cn/home/zhxw/2019-11-21/542357.html;\
									;\
								传统;\
									/2019/全国舞龙舞狮锦标赛/规定/20191110ctwl.mp4,\
									http://videoflv.sports.cn/201911/20191109ctwl.mp4,\
									http://dragonlion.sport.org.cn/home/zhxw/2019-11-21/542338.html;\
									;\
								;\
							;\
						;\
					;\
				".replace(/\t*/g, '')
			);
			console.log(tree.toString());
			var nodes = new Array;
			nodes[0] = tree.root;
			fillSelectBoxWithNodes(s1, nodes);
			nodes = setNext(nodes, s1);
			fillSelectBoxWithNodes(s2, nodes);
			nodes = setNext(nodes, s2);
			fillSelectBoxWithNodes(s3, nodes);
			nodes = setNext(nodes, s3);
			fillSelectBoxWithNodes(s4, nodes);
			if (s4.selectedIndex !== -1)
				video.src = nodes[s4.selectedIndex].value;
			console.log(video);

			console.log(video.childNodes);
		//-->
		</script>
		<noscript>浏览器不支持脚本，请使用高版本浏览器或点击链接</noscript>
	</main>
</body>

</html>