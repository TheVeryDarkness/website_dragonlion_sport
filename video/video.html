<!DOCTYPE html>
<html>
<meta lang="zh-Hans-CN" charset="utf-8">

<body>
	<main>
		<h2>
			运动项目<select required id="s1" multiple=false onchange="updateSelectBox()"></select>
			年份<select required id="s2" multiple=false onchange="updateSelectBox()"></select>
			赛事<select required id="s3" multiple=false onchange="updateSelectBox()"></select>
			组别<select required id="s4" multiple=false onchange="updateSelectBox()"></select>
			队伍<select required id="s5" multiple=false onchange="updateSelectBox()"></select>
			动作<select required id="s6" multiple=false onchange="updateSelectBox()"></select>
			<small><a href="">官网</a></small>
		</h2>
		<video id="video" controls="controls" type="video/mp4">浏览器不支持HTML5视频，请使用高版本浏览器或点击链接<source id="localCache"><source id="source"></video>
		<script type="text/javascript">
			//<!--
			function setVideoSourcePath(querySelector, srcPath) {
				querySelector.src = srcPath;
			}
			function findAQuerySelector(id) {
				return document.querySelector("#" + id);
			}
			function setVideoSourcePathWithId(video_id, srcPath) {
				var qS = findAQuerySelector(video_id);
				if (qS)
					setVideoSourcePath(qS, srcPath);
				else console.log("Failed to find a query selector with matching id.");
			}
			function Node(value) {
				this.value = value;
				if (this.value === null) return;//可能会提高效率
				this.sub = new Array(0);
				this.toString = function () {
					var str = new String(this.value);
					for (const child of this.sub) {
						str += child.toString();
					}
					return str;
				}
			}
			function MultiTree(callback) {
				this.root = new Node(callback.call());
				this.toString = function () {
					return this.root.toString();
				}
				var nodesStack = new Array();//里面存的都是Node对象
				if (this.root.value !== null) {
					nodesStack.push(this.root);
					var tmp;
					while (true) {
						tmp = new Node(callback.call());
						if (tmp.value) {
							nodesStack[nodesStack.length - 1].sub.push(tmp);
							nodesStack.push(tmp);
						}
						else {
							if (nodesStack.length > 0)
								nodesStack.pop();
							else break;
						}
					}
				}
			}
			function StringSplit(string) {
				this.split = string.split(';');
				this.call = function (thisObject) {
					if (this.split.length > 0)
						return this.split.shift();
					else return null;
				}
			}
			function makeAMultiTree(string) {
				var split = new StringSplit(string);
				var rev = new MultiTree(split);
				if (split.length > 0)
					console.log("Debug failed. Unexpected tree termination.");
				return rev;
			}
			const selectBoxMaxSize = 6;
			function fillSelectBoxWithSubValues(selectBox, subArray) {
				selectBox.size = Math.min(selectBox.size + subArray.length, selectBoxMaxSize);
				selectBox.options.length += subArray.length;
				for (const i in subArray) {
					selectBox.options[i].text = subArray[i].value;
				}
			}
			function fillSelectBoxWithNodes(selectBox, nodes) {
				selectBox.size = 0;
				fillSelectBoxWithSubValues(selectBox, nodes);
			}
			function nextNodes(nodes, selectedIndex) {
				if (selectedIndex === -1) {
					var rev = new Array;
					for (const node of nodes) {
						rev = rev.concat(node.sub);
					}
					return rev;
				}
				else {
					return nodes[s1.options[selectedIndex].index].sub;
				}
			}
			var tree = makeAMultiTree(
				"\
					舞龙;\
						2019;\
							全国舞龙舞狮锦标赛;\
								规定;\
									/2019/全国舞龙舞狮锦标赛/规定/20191110wlgd.mp4,\
									http://videoflv.sports.cn/201911/20191110wlgd.mp4,\
									http://dragonlion.sport.org.cn/home/zhxw/2019-11-21/542357.html;\
									;\
								;\
								传统;\
									/2019/全国舞龙舞狮锦标赛/规定/20191110ctwl.mp4,\
									http://videoflv.sports.cn/201911/20191109ctwl.mp4,\
									http://dragonlion.sport.org.cn/home/zhxw/2019-11-21/542338.html;\
									;\
								;\
							;\
						;\
					;\
				".replace(/\t*/g, '')
			);
			updateSelectBox();
			function updateSelectBox() {
				var nodes1 = new Array(tree.root);
				fillSelectBoxWithNodes(s1, nodes1);
				var nodes2 = nextNodes(nodes1, s1.selectedIndex);
				fillSelectBoxWithNodes(s2, nodes2);
				var nodes3 = nextNodes(nodes2, s2.selectedIndex);
				fillSelectBoxWithNodes(s3, nodes3);
				var nodes4 = nextNodes(nodes3, s3.selectedIndex);
				fillSelectBoxWithNodes(s4, nodes4);
				var nodes5 = nextNodes(nodes4, s4.selectedIndex);
				if (s4.selectedIndex !== -1)
					video.src = nodes4[s4.selectedIndex].sub[0].value;
			}
		//-->
		</script>
		<noscript>浏览器不支持脚本，请使用高版本浏览器或点击链接</noscript>
	</main>
</body>

</html>