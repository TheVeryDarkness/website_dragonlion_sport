<!DOCTYPE html>
<html>
<meta lang="zh-Hans-CN" charset="utf-8">

<body>
	<main>
		<h3>
			运动项目<select required id="s1" onchange="updateSelectBox()" size=1></select>
			年份<select required id="s2" onchange="updateSelectBox()" size=1></select>
			赛事<select required id="s3" onchange="updateSelectBox()" size=1></select>
			组别<select required id="s4" onchange="updateSelectBox()" size=1></select>
			队伍<select required id="s5" onchange="updateSelectBox()" size=1></select>
			动作<select required id="s6" onchange="updateSelectBox()" size=1></select>
			<small>
				<a id="originWebpage">源网页</a>
				<a id="originVideoURL">源视频</a>
			</small>
			<input type="button" onclick="updateSelectBox()" value="刷新">
		</h3>
		<h4>
			（温馨提示：请注意流量）
		</h4>
		<video id="video" controls type="video/mp4">浏览器不支持HTML5视频，请使用高版本浏览器或点击链接
			<source id="localVideoCache">
			<source id="sourceVideo">
		</video>
		<!--
			Pay attention to the data format:
				group name, local cache path, source video path, source webpage path
		-->
		<p hidden id="videoSrcData">
			舞龙;
				2019;
					全国舞龙舞狮锦标赛;
						规定,2019/全国舞龙舞狮锦标赛/规定/20191110wlgd.mp4,http://videoflv.sports.cn/201911/20191110wlgd.mp4,http://dragonlion.sport.org.cn/home/zhxw/2019-11-21/542357.html;
						;
						传统,2019/全国舞龙舞狮锦标赛/传统/20191109ctwl.mp4,http://videoflv.sports.cn/201911/20191109ctwl.mp4,http://dragonlion.sport.org.cn/home/zhxw/2019-11-21/542338.html;
						;
					;
				;
			;</p>
		<script type="text/javascript">
			//<!--
			function setVideoSourcePath(querySelector, srcPath) {
				querySelector.src = srcPath;
			}
			function findAQuerySelector(id) {
				return document.querySelector("#" + id);
			}
			function setVideoSourcePathWithId(video_id, srcPath) {
				var qS = findAQuerySelector(video_id);
				if (qS)
					setVideoSourcePath(qS, srcPath);
				else console.log("Failed to find a query selector with matching id.");
			}
			function Node(value) {
				this.value = value.split(',');
				this.sub = new Array(0);
				this.toString = function () {
					var str = new String(this.value);
					for (const child of this.sub) {
						str += child.toString();
					}
					return str;
				}
			}
			//Use callback.back() to generate a tree
			function MultiTree(callback) {
				this.root = new Node(callback.call());
				this.toString = function () {
					return this.root.toString();
				}
				var nodesStack = new Array();//里面存的都是Node对象
				if (this.root.value === null) return;

				nodesStack.push(this.root);
				while (true) {
					var value = callback.call();
					if (value) {
						var tmp = new Node(value);
						nodesStack[nodesStack.length - 1].sub.push(tmp);
						nodesStack.push(tmp);
					}
					else {
						if (nodesStack.length > 0)
							nodesStack.pop();
						else break;
					}
				}
			}
			function StringSplit(string) {
				const node_separator = ';';
				this.split = string.split(node_separator);
				this.call = function (thisObject) {
					if (this.split.length > 0)
						return this.split.shift();
					else return null;
				}
			}
			function makeAMultiTree(str) {
				var split = new StringSplit(str);
				var rev = new MultiTree(split);
				if (split.length > 0)
					console.log("Debug failed. Unexpected tree termination.");
				return rev;
			}
			const selectBoxMaxSize = 6;
			function fillSelectBoxWithSubValues(selectBox, subArray) {
				selectBox.options.length = subArray.length;
				for (const i in subArray) {
					selectBox.options[i].text = subArray[i].value[0];
				}
			}
			function fillSelectBoxWithNodes(selectBox, nodes) {
				fillSelectBoxWithSubValues(selectBox, nodes);
			}
			function nextNodes(nodes, selectedIndex) {
				if (selectedIndex === -1) {
					var rev = new Array;
					for (const node of nodes) {
						rev = rev.concat(node.sub);
					}
					return rev;
				}
				else {
					return nodes[selectedIndex].sub;
				}
			}
			var tree = makeAMultiTree(videoSrcData.textContent.replace(/\n[\t]*/g, ''));
			s1.selectedIndex = 0;
			s2.selectedIndex = 0;
			s3.selectedIndex = 0;
			s4.selectedIndex = 0;
			s5.selectedIndex = 0;
			s6.selectedIndex = 0;
			updateSelectBox();
			function updateSelectBox() {
				var nodes1 = new Array(tree.root);//运动项目
				fillSelectBoxWithNodes(s1, nodes1);
				var nodes2 = nextNodes(nodes1, s1.selectedIndex);//年份
				fillSelectBoxWithNodes(s2, nodes2);
				var nodes3 = nextNodes(nodes2, s2.selectedIndex);//赛事
				fillSelectBoxWithNodes(s3, nodes3);
				var nodes4 = nextNodes(nodes3, s3.selectedIndex);//组别
				fillSelectBoxWithNodes(s4, nodes4);
				var nodes5 = nextNodes(nodes4, s4.selectedIndex);//队伍
				if (s4.selectedIndex !== -1) {
					localVideoCache.src = nodes4[s4.selectedIndex].value[1];
					originVideoURL.href = nodes4[s4.selectedIndex].value[2];
					sourceVideo.src = nodes4[s4.selectedIndex].value[2];
					originWebpage.href = nodes4[s4.selectedIndex].value[3];
					video.load();
				}
				fillSelectBoxWithNodes(s5, nodes5);
				var nodes6 = nextNodes(nodes5, s5.selectedIndex);//动作
			}
		//-->
		</script>
		<noscript>浏览器不支持脚本，请使用高版本浏览器或点击链接</noscript>
	</main>
</body>

</html>